# BEGIN ECHRONOS BUILD MACHINERY

PRJ_TOOL = echronos/bin/prj.sh
ECHRONOS_BUILD = echronos/build

.SECONDEXPANSION:
$(LIB_BUILD)/%.a: $$(wildcard $(MODULES_DIR)/*/%.prx)
	$(BUILD_PRINT)
	$(PRJ_TOOL) \
		--no-project \
		--search-path echronos/share/packages \
		--search-path . \
		--output $(ECHRONOS_BUILD)/${*} \
		build $(subst .prx,,$(subst /,.,${<}))
	cp $(ECHRONOS_BUILD)/${*}/system.a ${@}
	rm -r out

echronos_lib_clean:
	$(CLEAN_PRINT)
	rm -r -f out
	rm -r -f $(ECHRONOS_BUILD)

# END ECHRONOS BUILD MACHINERY

# CONFIGURING NUMBAT SOURCE COMPILER OPTIONS
# (These inherit from the ti library compiler options)
# Be careful modifying cflags as they are delicately balanced to
# work. eChronos is compiled with its own set of cflags, as are the
# TI libraries.

PART=TM4C123GH6PM
CFLAGSgcc=-DTARGET_IS_TM4C123_RB1
include .ti_makedefs
IPATH=$(TI_LIBS)
IPATH+=$(MODULES_DIR)/boilerplate

$(BUILD_DIR)/%.o: $(wildcard $(MODULES_DIR)/*/%.c)
	$(BUILD_PRINT)
	${CC} ${CFLAGS} \
		-I$(ECHRONOS_BUILD)/$(subst modules/,,$(<D))-echronos/ \
		-I$(<D) \
		-D${COMPILER} -o ${@} ${<}

$(BUILD_DIR)/%.opp: $(wildcard $(MODULES_DIR)/*/%.cpp)
	$(BUILD_PRINT)
	${CC} ${CPPFLAGS} \
		-I$(ECHRONOS_BUILD)/$(subst modules/,,$(<D))-echronos/ \
		-I$(<D) \
		-D${COMPILER} -o ${@} ${<}

$(BUILD_DIR)/%.elf:
	$(BUILD_PRINT)
	${LD} \
		  ${^} 								    \
		  $(ROS_BUILD_DIR)/*.opp \
		  $(LIB_BUILD)/libusb.a                 \
		  $(LIB_BUILD)/libutil.a                \
		  $(LIB_BUILD)/libdriver.a				\
		  $(LIB_BUILD)/libsensor.a				\
		  '${LIBM}' '${LIBC}' '${LIBGCC}'       \
		  -T $(ECHRONOS_BUILD)/$(*F)-echronos/new.ld       \
		  -o ${@} \
          --print-memory-usage
	$(MODULE_PRINT)

